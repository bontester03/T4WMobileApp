<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="T4sV1.Views.HealthScorePage"
             xmlns:viewmodels="clr-namespace:T4sV1.Model.ViewModels"
             xmlns:healthscore="clr-namespace:T4sV1.Model.HealthScore"
             x:DataType="viewmodels:HealthScoreViewModel"
             Title="Health Scores"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="Auto,*" Padding="0">

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="0"
                          IsRunning="{Binding IsLoading}"
                          IsVisible="{Binding IsLoading}"
                          Color="#6200EE"
                          VerticalOptions="Center"
                          HorizontalOptions="Center"
                          Margin="20"/>

        <ScrollView Grid.Row="1" Padding="16">
            <ScrollView.Background>
                <!-- StartPoint defaults to (0,0) -->
                <LinearGradientBrush EndPoint="0,1">
                    <GradientStop Color="#e9fdb6" Offset="0.1" />
                    <GradientStop Color="#9dc052" Offset="1.0" />
                </LinearGradientBrush>
            </ScrollView.Background>
            <VerticalStackLayout Spacing="16">

                <!-- Error Message -->
                <Frame IsVisible="{Binding HasError}"
                       BackgroundColor="#FFEBEE"
                       BorderColor="#F44336"
                       CornerRadius="8"
                       Padding="12">
                    <Label Text="{Binding ErrorMessage}"
                           TextColor="#D32F2F"
                           FontSize="14"/>
                </Frame>

                <!-- No Data Message -->
                <Frame IsVisible="{Binding NoDataAvailable}"
                       BackgroundColor="White"
                       BorderColor="#E0E0E0"
                       CornerRadius="12"
                       Padding="20">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <Label Text="ðŸ“Š"
                               FontSize="48"
                               HorizontalOptions="Center"/>
                        <Label Text="No Health Scores Yet"
                               FontSize="18"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="#333"/>
                        <Label Text="Add your first health score to track wellness"
                               FontSize="14"
                               TextColor="#666"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                        <Button Text="Add Health Score"
                                Command="{Binding AddHealthScoreCommand}"
                                BackgroundColor="#6200EE"
                                TextColor="White"
                                CornerRadius="8"
                                Margin="0,12,0,0"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Latest Health Score Card -->
                <Frame IsVisible="{Binding HasData}"
                       BackgroundColor="White"
                       BorderColor="#E0E0E0"
                       CornerRadius="12"
                       Padding="20">
                    <VerticalStackLayout Spacing="16">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="Latest Health Score"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="#333"/>
                            <Label Grid.Column="1"
                                   Text="{Binding DateRecordedDisplay}"
                                   FontSize="12"
                                   TextColor="#999"
                                   VerticalOptions="Start"/>
                        </Grid>

                        <!-- Total Score -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Total Score"
                                       FontSize="14"
                                       TextColor="#666"/>
                                <Label Text="{Binding TotalScoreDisplay}"
                                       FontSize="32"
                                       FontAttributes="Bold"
                                       TextColor="#6200EE"/>
                                <Label Text="out of 25"
                                       FontSize="12"
                                       TextColor="#999"/>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Overall Score"
                                       FontSize="14"
                                       TextColor="#666"/>
                                <Label Text="{Binding OverallScore10Display}"
                                       FontSize="32"
                                       FontAttributes="Bold"
                                       TextColor="#4CAF50"/>
                                <Label Text="out of 10"
                                       FontSize="12"
                                       TextColor="#999"/>
                            </VerticalStackLayout>
                        </Grid>

                        <BoxView HeightRequest="1" BackgroundColor="#E0E0E0"/>

                        <!-- Health Scores Breakdown -->
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" 
                              ColumnDefinitions="*,Auto"
                              RowSpacing="12">

                            <!-- Physical Activity -->
                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="ðŸƒ Physical Activity"
                                   FontSize="14"
                                   TextColor="#333"/>
                            <Label Grid.Row="0" Grid.Column="1"
                                   Text="{Binding PhysicalActivityDisplay}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#6200EE"/>

                            <!-- Breakfast -->
                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="ðŸ³ Breakfast"
                                   FontSize="14"
                                   TextColor="#333"/>
                            <Label Grid.Row="1" Grid.Column="1"
                                   Text="{Binding BreakfastDisplay}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#6200EE"/>

                            <!-- Fruit & Veg -->
                            <Label Grid.Row="2" Grid.Column="0"
                                   Text="ðŸ¥— Fruit and Vegetables"
                                   FontSize="14"
                                   TextColor="#333"/>
                            <Label Grid.Row="2" Grid.Column="1"
                                   Text="{Binding FruitVegDisplay}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#6200EE"/>

                            <!-- Sweet Snacks -->
                            <Label Grid.Row="3" Grid.Column="0"
                                   Text="ðŸ¬ Sweet Snacks"
                                   FontSize="14"
                                   TextColor="#333"/>
                            <Label Grid.Row="3" Grid.Column="1"
                                   Text="{Binding SweetSnacksDisplay}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#6200EE"/>

                            <!-- Fatty Foods -->
                            <Label Grid.Row="4" Grid.Column="0"
                                   Text="ðŸ” Fatty Foods"
                                   FontSize="14"
                                   TextColor="#333"/>
                            <Label Grid.Row="4" Grid.Column="1"
                                   Text="{Binding FattyFoodsDisplay}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#6200EE"/>
                        </Grid>

                    </VerticalStackLayout>
                </Frame>

                <!-- History Section -->
                <Frame IsVisible="{Binding HasData}"
                       BackgroundColor="White"
                       BorderColor="#E0E0E0"
                       CornerRadius="12"
                       Padding="20">
                    <VerticalStackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="Health Score History"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="#333"/>
                            <Button Grid.Column="1"
                                    Text="+ Add"
                                    Command="{Binding AddHealthScoreCommand}"
                                    BackgroundColor="#6200EE"
                                    TextColor="White"
                                    CornerRadius="6"
                                    Padding="12,6"/>
                        </Grid>

                        <CollectionView ItemsSource="{Binding HealthScores}"
                                       EmptyView="No health scores recorded yet">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="healthscore:HealthScoreDto">
                                    <Frame Margin="0,4" 
                                           BackgroundColor="#F9F9F9"
                                           BorderColor="#E0E0E0"
                                           CornerRadius="8"
                                           Padding="12">
                                        <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
                                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                                <Label Text="{Binding DateRecorded, StringFormat='{0:MMM dd, yyyy}'}"
                                                       FontSize="14"
                                                       FontAttributes="Bold"
                                                       TextColor="#333"/>
                                                <Label Text="{Binding TotalScore, StringFormat='Total: {0}/25'}"
                                                       FontSize="12"
                                                       TextColor="#666"/>
                                                <Label Text="{Binding OverallScore10, StringFormat='Score: {0:F1}/10'}"
                                                       FontSize="12"
                                                       TextColor="#666"/>
                                            </VerticalStackLayout>
                                            <Button Grid.Column="1"
                                                    Text="Edit"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:HealthScoreViewModel}}, Path=EditHealthScoreCommand}"
                                                    CommandParameter="{Binding .}"
                                                    BackgroundColor="#03A9F4"
                                                    TextColor="White"
                                                    CornerRadius="6"
                                                    Padding="8,4"
                                                    FontSize="12"/>
                                            <Button Grid.Column="2"
                                                    Text="Delete"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:HealthScoreViewModel}}, Path=DeleteHealthScoreCommand}"
                                                    CommandParameter="{Binding .}"
                                                    BackgroundColor="#F44336"
                                                    TextColor="White"
                                                    CornerRadius="6"
                                                    Padding="8,4"
                                                    FontSize="12"/>
                                        </Grid>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Action Buttons -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,8">
                    <Button Grid.Column="0"
                            Text="ðŸ”„ Refresh"
                            Command="{Binding RefreshCommand}"
                            BackgroundColor="#4CAF50"
                            TextColor="White"
                            CornerRadius="8"/>
                    <Button Grid.Column="1"
                            Text="â† Back"
                            Command="{Binding GoBackCommand}"
                            BackgroundColor="#9E9E9E"
                            TextColor="White"
                            CornerRadius="8"/>
                </Grid>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
